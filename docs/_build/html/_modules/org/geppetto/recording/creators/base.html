<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>org.geppetto.recording.creators.base &mdash; org.geppetto.recording 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <link rel="top" title="org.geppetto.recording 0.0.1 documentation" href="../../../../../index.html" />
    <link rel="up" title="Module code" href="../../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../../../../index.html">org.geppetto.recording 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for org.geppetto.recording.creators.base</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>

<span class="c"># TODO: Make clear in the docs what these mean and especially what the difference between PARAMETER and PROPERTY is</span>
<span class="n">MetaType</span> <span class="o">=</span> <span class="n">Enum</span><span class="p">(</span><span class="s">&#39;STATE_VARIABLE&#39;</span><span class="p">,</span> <span class="s">&#39;PARAMETER&#39;</span><span class="p">,</span> <span class="s">&#39;PROPERTY&#39;</span><span class="p">,</span> <span class="s">&#39;EVENT&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_text_file</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return True if the file is text, False if it is binary.&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">test_string</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
        <span class="n">text_characters</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">127</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\b</span><span class="s">&#39;</span><span class="p">])</span>
        <span class="n">null_translation</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">test_string</span><span class="p">:</span>  <span class="c"># empty file -&gt; text</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="s">&#39;</span><span class="se">\0</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">test_string</span><span class="p">:</span>  <span class="c"># file with null byte -&gt; binary</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">non_text_characters</span> <span class="o">=</span> <span class="n">test_string</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">null_translation</span><span class="p">,</span> <span class="n">text_characters</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">non_text_characters</span><span class="p">))</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_string</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">0.30</span><span class="p">:</span>  <span class="c"># more than 30% non-text characters -&gt; binary</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>


<div class="viewcode-block" id="RecordingCreator"><a class="viewcode-back" href="../../../../../creators.html#org.geppetto.recording.creators.base.RecordingCreator">[docs]</a><span class="k">class</span> <span class="nc">RecordingCreator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class allows to create a recording for Geppetto.</span>

<span class="sd">    There should be one instance of this class per recording created.</span>
<span class="sd">    In order to create a recording instantiate this class specifying the filename of the recording you wish to create</span>
<span class="sd">     and the simulator used to produce the recording.</span>
<span class="sd">    The method add_values allows to add a recording for a given variable by specifying its path.</span>
<span class="sd">    It is possible to call add_values multiple times for the same path (values will be appended) or call it once</span>
<span class="sd">     specifying a list of values.</span>
<span class="sd">    Once all the values have been appended call either add_fixed_time_step_vector or  add_variable_time_step_vector</span>
<span class="sd">     to generate a vector with values for time.</span>
<span class="sd">    The values provided with the method add_values will be associated with the corresponding time step at the same index</span>
<span class="sd">     in the time vector.</span>
<span class="sd">    Additionally, global metadata of various types can be added through add_metadata.</span>
<span class="sd">    Once all the values have been added and the time vector generated it is possible to create the recording</span>
<span class="sd">     by calling create().</span>

<span class="sd">    Example:</span>
<span class="sd">    time [0.1, 0.2, 0.3, 0.4, 0.5]</span>
<span class="sd">    cell</span>
<span class="sd">        v1 [0.65, 0.66, 0.67, 0.68, 0.69]</span>
<span class="sd">        v2 [0.20, 0.20, 0.21, 0.22, 0.23]</span>
<span class="sd">    0.67 will be the value of cell.v1 at 0.3ms</span>
<span class="sd">    0.22 will be the value of cell.v2 at 0.4ms</span>

<span class="sd">    Snippet:</span>
<span class="sd">    creator = RecordingCreator(&#39;example1.h5&#39;)</span>
<span class="sd">    creator.add_values(&#39;a&#39;, 1, &#39;float_&#39;, &#39;mV&#39;, MetaType.STATE_VARIABLE)</span>
<span class="sd">    creator.add_values(&#39;a&#39;, 2, &#39;float_&#39;, &#39;mV&#39;, MetaType.STATE_VARIABLE)</span>
<span class="sd">    creator.add_values(&#39;a.b&#39;, 1, &#39;float_&#39;, &#39;mV&#39;, MetaType.STATE_VARIABLE)</span>
<span class="sd">    creator.add_values(&#39;a.b.param1&#39;, 1, &#39;float_&#39;, &#39;mV&#39;, MetaType.PARAMETER)</span>
<span class="sd">    creator.add_values(&#39;a.b.prop1&#39;, 1, &#39;float_&#39;, &#39;mV&#39;, MetaType.PROPERTY)</span>
<span class="sd">    creator.add_values(&#39;a.b.c.d&#39;, [1, 2, 3, 4, 5, 6], &#39;float_&#39;, &#39;mV&#39;, MetaType.STATE_VARIABLE)</span>
<span class="sd">    creator.add_values(&#39;a.b&#39;, 2, &#39;float_&#39;, &#39;mV&#39;, MetaType.STATE_VARIABLE)</span>
<span class="sd">    creator.add_fixed_time_step_vector(1, &#39;ms&#39;)</span>
<span class="sd">    creator.add_metadata(&#39;string_metadata&#39;, &#39;description or link&#39;)</span>
<span class="sd">    creator.add_metadata(&#39;float_metadata&#39;, 1.0)</span>
<span class="sd">    creator.add_metadata(&#39;boolean_metadata&#39;, True)</span>
<span class="sd">    creator.create()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">simulator</span><span class="o">=</span><span class="s">&#39;Not specified&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">False</span><span class="p">,):</span>
        <span class="c"># TODO: Add support for file to be reopened</span>
        <span class="c"># TODO: Test</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_previous_file</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>  <span class="c"># file</span>
                <span class="k">if</span> <span class="n">overwrite</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_previous_file</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;File already exists, set the overwrite flag to remove it before writing: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># directory</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;Filename points to a directory: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_types</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span> <span class="o">=</span> <span class="n">simulator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="RecordingCreator.add_values"><a class="viewcode-back" href="../../../../../creators.html#org.geppetto.recording.creators.base.RecordingCreator.add_values">[docs]</a>    <span class="k">def</span> <span class="nf">add_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">meta_type</span><span class="p">,</span> <span class="n">is_single_value</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add one or multiple values to the variable `label`.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Label is empty&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">meta_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MetaType</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;Meta type is not a member of enum MetaType: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">meta_type</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># dimensionless</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="c"># TODO: Use numpy arrays instead? -&gt; Check performance of extending numpy arrays vs python lists</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_single_value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta_types</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta_type</span>
</div>
<div class="viewcode-block" id="RecordingCreator.add_time"><a class="viewcode-back" href="../../../../../creators.html#org.geppetto.recording.creators.base.RecordingCreator.add_time">[docs]</a>    <span class="k">def</span> <span class="nf">add_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_step_or_vector</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
        <span class="k">print</span> <span class="n">time_step_or_vector</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;Time has already been defined previously&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">unit</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The time unit cannot be empty&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">time_step_or_vector</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Supply a time step or vector and be a good boy&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_step_or_vector</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time_step_or_vector</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The time step cannot be 0&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">time_step_or_vector</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_step_or_vector</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;The time vector cannot be empty&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">time_step_or_vector</span>  <span class="c"># will be parsed in _process_added_values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span> <span class="o">=</span> <span class="n">unit</span>
</div>
    <span class="k">def</span> <span class="nf">_process_added_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;simulator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">simulator</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">f</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c"># TODO: Should the number of steps in the state variables match (with each other and with the time vector) or should it only be smaller than the time vector?</span>
        <span class="c"># num_steps = None</span>
        <span class="c"># for label in self.values.keys():</span>
        <span class="c">#     if self.meta_types[label] == MetaType.STATE_VARIABLE:</span>
        <span class="c">#         if num_steps is None:</span>
        <span class="c">#             num_steps = len(self.values[label])</span>
        <span class="c">#         else:</span>
        <span class="c">#             if len(self.values[label]) != num_steps:</span>
        <span class="c">#                 raise IndexError(&quot;The number of steps in the state variables do not match&quot;)</span>

        <span class="n">max_num_steps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta_types</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">==</span> <span class="n">MetaType</span><span class="o">.</span><span class="n">STATE_VARIABLE</span><span class="p">:</span>
                <span class="n">max_num_steps</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_num_steps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">label</span><span class="p">]))</span>

        <span class="n">is_time_vector</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_num_steps</span> <span class="ow">or</span> <span class="n">is_time_vector</span><span class="p">:</span>  <span class="c"># do not write time for a fixed time step and no state variables</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s">&quot;There are state variables but no time is defined, call add_time&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_time_vector</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">!=</span> <span class="n">max_num_steps</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s">&quot;The number of steps in the time vector and in the state variables do not match&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c"># fixed time step</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_num_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">max_num_steps</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">f</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
            <span class="n">f</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_unit</span>

        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="n">f</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="n">f</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s">&#39;meta_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta_types</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="c"># TODO: What are ALL the reasons that raise this exception?</span>
                <span class="c"># TODO: Should the case &#39;A previous leaf is now referred to as a type&#39; be explicitly mentioned in the error message?</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Cannot write dataset for variable &quot;</span> <span class="o">+</span> <span class="n">label</span><span class="p">)</span>

<div class="viewcode-block" id="RecordingCreator.add_metadata"><a class="viewcode-back" href="../../../../../creators.html#org.geppetto.recording.creators.base.RecordingCreator.add_metadata">[docs]</a>    <span class="k">def</span> <span class="nf">add_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Supply a name and be a good boy&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># empty metadata, for example to set a flag</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="RecordingCreator.create"><a class="viewcode-back" href="../../../../../creators.html#org.geppetto.recording.creators.base.RecordingCreator.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_previous_file</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w-&#39;</span><span class="p">)</span>  <span class="c"># create file here to avoid an empty file if an error occurs</span>
        <span class="c"># TODO: Have the logic from _process_added_values in here?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_added_values</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../../../../index.html">org.geppetto.recording 0.0.1 documentation</a> &raquo;</li>
          <li><a href="../../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Johannes Rieke, Matteo Cantarelli.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>